mixin system(index, data)
    li.paper
        .paper-content
            h3=index
            input(type='hidden', name='systems[#{index}].index', value=data.index)
            table.full-width
                caption
                    a.btn.remove-btn(href='javascript:void(0)',data-role='remove-btn') &times;
                    input(type='text', data-role='editable-text',
                    placeholder=l.plh.system_name,
                    value=data.name,
                    name='systems[#{index}].name').system-name-input

                thead
                tbody
                tr
                    th
                        label=l.lbl.code
                    td
                        input(type='text', name='systems[#{index}].code', value=data.code)
                tr
                    th
                        label=l.lbl.scale
                    td
                        input(type='number', name='systems[#{index}].scale', value=data.scale)
                        small
                            i=l.lbl.scale_unit
                tr
                    th
                        label=l.lbl.provider
                    td
                        select(name='systems[#{index}].provider')
                            option(value='')
                            for developer in developers
                                option(value=developer._id,
                                selected=developer._id==data.provider
                                )=developer.name

                tr
                    th
                        label=l.lbl.freeword
                    td
                        textarea.full-width(name='systems[#{index}].freeword',
                        placeholder=l.plh.freeword,
                        value=data.freeword)
            br.clear


section#client-detail-section.positioned
    a.float-right#edit-btn(href='javascript:void(0)')
        i.icon.icon-pencil
        sapn=l.btn.edit
    br.clear
    #save-done-msg.stick-left.stick-top
        .msg-balloon
            span=l.msg.save_done
    form#client-detail-form(method='post', action='/api/client/save'
    )
        #client-detail-form-cover.cover
        .posotioned


            input(type='hidden', name='_id', value=selected_client._id)
            h1
                input(type='text', data-role='editable-text', name='name', value=selected_client.name).full-width.large-input


            fieldset#salesman-fieldset
                legend=l.lbl.salesman
                for salesman in salesmen
                    label.checkable-label(for="salesman-#{salesman._id}")
                        input(
                        name='salesman_ids',
                        type="checkbox",
                        checked=selected_client.salesman_ids.match(salesman._id)
                        id="salesman-#{salesman._id}",
                        value=salesman._id)
                        span=salesman.name
            br.clear

            fieldset
                legend=l.lbl.systems

                ul#system-list.no-style-list
                    for system in selected_client.systems
                        if system
                            +system(system.index, system)

                div#system-list-item-tmpl.hidden
                    +system('',"c")
                br.clear
                a#new-system-btn.add-btn.wide-btn(
                href='javascript:void(0)') + #{l.btn.new} #{l.lbl.system}

                br.clear
            br.clear
            input#save-btn.btn.primary-btn.wide-btn(type="submit", value=l.btn.save)

    ul#system-name-select-list.no-style-list.hidden.select-list
        for system_name in system_names
            li
                a(href='javascript:void(0)')=system_name


